<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yann_Casey_strategy_v0.1 - Strategy Analysis</title>
    
    <style>
        :root {
            --primary: #3498db;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --dark: #2c3e50;
            --light: #ecf0f1;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
        }
        
        .back-link:hover {
            text-decoration: underline;
        }
        
        h1 {
            color: var(--dark);
            border-bottom: 3px solid var(--primary);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        
        h2 {
            color: #34495e;
            margin-top: 30px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary);
            padding-left: 15px;
        }
        
        .header-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .info-box {
            background: var(--light);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
        }
        
        .info-box strong {
            display: block;
            color: var(--dark);
            margin-bottom: 5px;
            font-size: 0.9em;
        }
        
        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 15px;
            color: white;
            font-size: 0.85em;
            font-weight: 500;
        }
        
        .badge-yes {
            background: var(--success);
        }
        
        .badge-no {
            background: #95a5a6;
        }
        
        .score {
            font-size: 1.5em;
            font-weight: bold;
        }
        
        .score-high {
            color: var(--success);
        }
        
        .score-medium {
            color: var(--warning);
        }
        
        .score-low {
            color: var(--danger);
        }
        
        .section {
            margin: 25px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .analysis-list {
            margin: 10px 0 10px 20px;
        }
        
        .analysis-list li {
            margin: 8px 0;
        }
        
        .code-block {
            background: #282c34;
            color: #abb2bf;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .patterns-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 10px 0;
        }
        
        .pattern-tag {
            background: var(--light);
            padding: 5px 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9em;
        }
        
        .links-section {
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            color: white;
        }
        
        .links-section a {
            color: white;
            text-decoration: underline;
        }
        
        @media (max-width: 768px) {
            .header-grid {
                grid-template-columns: 1fr;
            }
            
            body {
                padding: 10px;
            }
            
            .container {
                padding: 15px;
            }
        }
    </style>
    
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">‚Üê Retour √† la liste</a>
        
        <h1>üìä Yann_Casey_strategy_v0.1</h1>
        
        <div class="header-grid">
            <div class="info-box">
                <strong>Type</strong>
                <span class="badge" style="background-color: #3498db">BREAKOUT</span>
            </div>
            <div class="info-box">
                <strong>Sous-type</strong>
                <span>Session_Range</span>
            </div>
            <div class="info-box">
                <strong>Score Qualit√©</strong>
                <span class="score score-high">7/10</span>
            </div>
            <div class="info-box">
                <strong>Score Complexit√©</strong>
                <span class="score score-high">9/10</span>
            </div>
        </div>
        
        <div class="section">
            <h2>üìù R√©sum√©</h2>
            <p>A sophisticated <strong>intraday breakout strategy</strong> that trades breakouts of key levels (PDH, PDL, PMH, PML) with <strong>EMA trend confirmation</strong> and <strong>retest validation</strong>. Uses historical support/resistance arrays for dynamic profit targets and combines <strong>trailing stops</strong> with fixed stops for risk management.</p>
        </div>
        
        <div class="section">
            <h2>üéØ Conditions d'Entr√©e</h2>
            <p><strong>LONG Entries:</strong>
‚Ä¢ Breakout above PDH or PMH with retest confirmation
‚Ä¢ EMA13 &gt; EMA48 &gt; EMA200 (bullish trend alignment)
‚Ä¢ Close &gt; EMA13 (price above fast EMA)
‚Ä¢ Close &gt; PDL (above previous day low)
‚Ä¢ During regular trading session (930-1600)
‚Ä¢ Within trading window (930-1200)
‚Ä¢ Pattern filter: PatternFast(152) = true AND PatternFast(153) = false

<strong>SHORT Entries:</strong>
‚Ä¢ Breakout below PDL or PML with retest confirmation
‚Ä¢ EMA13 &lt; EMA48 &lt; EMA200 (bearish trend alignment)
‚Ä¢ Close &lt; EMA13 (price below fast EMA)
‚Ä¢ Close &lt; PDH (below previous day high)
‚Ä¢ During regular trading session (930-1600)
‚Ä¢ Within trading window (930-1200)
‚Ä¢ Pattern filter: PatternFast(152) = true AND PatternFast(153) = false</p>
        </div>
        
        <div class="section">
            <h2>üö™ Conditions de Sortie</h2>
            <p><strong>Normal Exits:</strong>
‚Ä¢ Trailing stop: Exit when Close crosses EMA13 with epsilon buffer
‚Ä¢ End of session: Exit 10 minutes before market close (1550)

<strong>Stop/Target Exits:</strong>
‚Ä¢ Fixed stop loss: Above/below broken level + epsilon
‚Ä¢ Partial profit target: 50% position at next historical resistance (longs) or support (shorts)
‚Ä¢ Global stop loss: 10,000 in currency

<strong>Time Exits:</strong>
‚Ä¢ Mandatory exit at 1550 (10 minutes before session end)
‚Ä¢ Sequence timeout: 60 minutes after breakout if no retest</p>
        </div>
        
        <div class="header-grid">
            <div class="info-box">
                <strong>Stop Loss</strong>
                <ul class="analysis-list"><li>SetStopLoss(<strong>10000</strong>) = 10,000 in <strong>currency</strong>
‚Ä¢ Additional: Fixed stop at broken level ¬± EpsilonSupport (0.02)
‚Ä¢ Trailing: EMA13 ¬± EpsilonSupport</li></ul>
            </div>
            <div class="info-box">
                <strong>Take Profit</strong>
                <ul class="analysis-list"><li>Dynamic target from historical support/resistance arrays
‚Ä¢ Partial exit: 50% of position at next significant level
‚Ä¢ No fixed point-based targets</li></ul>
            </div>
            <div class="info-box">
                <strong>Exit On Close</strong>
                <span class="badge badge-yes">YES</span>
            </div>
            <div class="info-box">
                <strong>Time Exit</strong>
                <span class="badge badge-yes">YES</span>
            </div>
        </div>
        
        <div class="section">
            <h2>üîß Patterns & Fonctions</h2>
            <div class="patterns-list"><span class="pattern-tag">PatternFast(152)</span><span class="pattern-tag">PatternFast(153)</span><span class="pattern-tag">_OHLCMulti5()</span></div>
            <p><strong>Nombre de patterns:</strong> 3</p>
        </div>
        
        <div class='section'><h2>üîç D√©tails des Patterns</h2><p><strong>PatternFast(152):</strong> true
‚Ä¢ Meaning: Always returns true
‚Ä¢ Indicates: No pattern restriction
‚Ä¢ Trading use: Neutral filter allowing all trades

<strong>PatternFast(153):</strong> false (case &gt;152)
‚Ä¢ Meaning: Always returns false for numbers &gt; 152
‚Ä¢ Indicates: Invalid pattern number
‚Ä¢ Trading use: Used as negative filter (must be false to trade)

<strong>_OHLCMulti5():</strong> Session OHLC calculator
‚Ä¢ Meaning: Calculates session-based OHLC values for last 5 sessions
‚Ä¢ Indicates: Provides historical price data for pattern analysis
‚Ä¢ Trading use: Feeds data to PatternFast function for technical analysis</p></div>
        
        <div class="section">
            <h2>‚≠ê Analyse Qualit√©</h2>
            <p><strong>STRENGTHS:</strong>
‚Ä¢ Sophisticated level identification using historical support/resistance arrays
‚Ä¢ Multiple confirmation layers: breakout + retest + EMA alignment
‚Ä¢ Dynamic profit targets based on historical levels
‚Ä¢ Proper session time filtering and pre-market data integration
‚Ä¢ Multiple exit strategies: trailing, fixed stops, and time-based
‚Ä¢ Risk controls: max trades per day, position sizing, global stop

<strong>WEAKNESSES:</strong>
‚Ä¢ Extremely complex with nested loops that could cause performance issues
‚Ä¢ Pattern filters are essentially meaningless (152=true, 153=false always)
‚Ä¢ Overly complicated level calculation with potential for bugs
‚Ä¢ Hard-coded timeframes may not suit all instruments
‚Ä¢ Complex retest logic might miss valid setups
‚Ä¢ No consideration for market volatility or volume

<strong>RISK MANAGEMENT:</strong>
‚Ä¢ Good: Multiple stop loss layers (fixed, trailing, global)
‚Ä¢ Good: Position sizing controls and daily trade limits
‚Ä¢ Concern: Very high global stop loss (10,000) may be excessive
‚Ä¢ Good: Time-based exits prevent overnight exposure

<strong>OVERALL:</strong>
This is a <strong>highly sophisticated but overly complex</strong> strategy that attempts to combine many good concepts. The core logic of trading <strong>PDH/PDL breakouts with EMA confirmation</strong> is sound, but the implementation is unnecessarily complicated. The strategy would benefit from <strong>significant simplification</strong> while retaining the core breakout and trend filter concepts. The pattern filters add no value and the complex level calculations could be streamlined.</p>
        </div>
        
        
        
        <h2>üíª Code Source</h2>
        <div class="code-block"><pre>// =============================================================================
// STRATEGIE CASEY - VERSION SIMPLE ET EFFICACE
// =============================================================================
// Type: STRATEGY 
// Timeframe requis: 2 minutes
// Instruments: Actions liquides (SPY, QQQ, AAPL, TSLA, etc.)
// =============================================================================


{ VERSION SIMPLE ET EFFICACE DE L&#39;ALGORITHME CASEY 

Apres des jours de developpement de versions plus completes et complexes, je n&#39;ai jamais egale la performance de cet algo plus simple sur NQ a minima.


Fonctionne sur ES et NQ 2&#39; principalement sur les LONG.
La strategie se resume a:
- Achat sur Breakout de niveau PDH/PMH
- Trailing SL EMA13 + Hard Stop sous PDH/PMH


Logique globale:
1- Creation du tableau des supports (les PDL des precedentes sessions)
2- Determination des niveaux PML, PDL, PMH, PDH
3 Long : Si breakout et retest PDH ou PMH avec EMA13&gt;EMA48&gt;EMA200 et Close&gt;EMA13 ET Filtres UA alors Buy 2 contracts
3 Short: Si breakout et retest PDL ou PML avec EMA13&lt;EMA48&lt;EMA200 et Close&lt;EMA13 ET Filtres UA  alors Sell 2 contracts
4-TP1 - 1 contract: Pour les longs: Premiere resistance dans le tableau. Pour les Shorts: Premier Support dans le tableau
5- Trailing SL EMA13 pour stopper le trade.

}



//&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;	Michael OHLC Calculation begin
array: ohlcValues[23](0), adxCalcValues[3](0);
var: isStartOfSession(false), adxVal(0);
isStartOfSession = _OHLCMulti5(MichaelsessionStartTimeA, MichaelsessionEndTimeA, ohlcValues);


// ==================== INPUTS ====================
inputs:
    useShort(1), useLong(1),
    mySize(2),
    Trading_StartTime(930), TradingEndTime(1200),
    MichaelsessionStartTimeA(1800), MichaelsessionEndTimeA(1700),	//Set here your session Time!

    PtnNeutLY (152),     PtnNeutLN (153), PtnNeutSY(152), PtnNeutSN(153), 
    
    // Configuration EMAs
    EMA_Fast(13),
    EMA_Medium(48),
    EMA_Slow(200),
    
    // Configuration Sessions
    RegularSessionStart(930),
    RegularSessionEnd(1600),
    PreMarketStart(400),
    PreMarketEnd(930),
    
    // Configuration Risk Management
    EpsilonSupport(0.02),            // Buffer pour stops et TP
    MaxTradesPerDay(2),
    MaxHistoricalDays(10),           // Jours historiques ? scanner
    maxSL(10000),
    
    // Configuration S?quences
    SignalTimeWindow(60),            // Minutes max pour retest
    BreakoutEpsilon(0.01),           // Tol?rance breakout
    
    // skip days and months
    skipMonth(9), skipDay(0);

// ==================== VARIABLES ====================
arrays:
    SupportLevels[20](0),            // Tableau des supports (PDL historiques)
    ResistanceLevels[20](0);         // Tableau des r?sistances (PDH historiques)

variables:
    // Compteurs de niveaux
    SupportCount(0),
    ResistanceCount(0),
    
    // Trading Window
    tw(false),
    
    // Niveaux cl?s ACTUELS
    PDH(0), PDL(0),                  // Previous Day High/Low
    PMH(0), PML(0),                  // Pre-Market High/Low
    
    // EMAs
    EMA13(0), EMA48(0), EMA200(0),
    
    // ?tats de session
    IsRegularSession(false),
    NewDay(false),
    SessionStart(false),
    
    // Tracking des breakouts
    PDLBroken(false), PMLBroken(false),
    PDHBroken(false), PMHBroken(false),
    BreakoutBar(0),
    BrokenLevel(0),                  // Niveau qui a ?t? cass?
    
    // S?quences de signaux
    SequenceActive(false),
    SequenceStartTime(0),
    RetestDone(false),
    
    // Conditions de setup
    CanEnterLong(false), CanEnterShort(false), authorizedTrading(true),
    
    // Gestion position
    TradesCountToday(0),
    EntryLevel(0),                   // Niveau sur lequel on est entr?
    StopLevel(0),                    // Stop fixe
    TargetLevel(0),                  // Take profit
    
    // Variables de boucle
    LoopCounter(0), idx(0),
    SearchHigh(0), SearchLow(999999),
    FoundHigh(false), FoundLow(false),
    LastTradingDate(0),
    DaysScanned(0),
    
    // Pre-market
    PMHigh(0), PMLow(999999),
    HasPMData(false),
    
    // Variables pour mise ? jour des tableaux
    NextSupport(0), NextResistance(0),
    TempLevel(0);

// ==================== CALCULS PR?LIMINAIRES ====================

authorizedTrading= Month(Date)&lt;&gt;skipMonth and dayofweek(date)&lt;&gt;skipday;

// EMAs
EMA13 = XAverage(Close, EMA_Fast);
EMA48 = XAverage(Close, EMA_Medium);
EMA200 = XAverage(Close, EMA_Slow);

// Sessions
IsRegularSession = (Time &gt;= RegularSessionStart and Time &lt;= RegularSessionEnd);
NewDay = (Date &lt;&gt; Date[1]);
SessionStart = (Time = RegularSessionStart);
tw = time &gt;= Trading_StartTime and time &lt; TradingEndTime;

// ==================== CALCUL DES NIVEAUX ====================

// PDH/PDL ? chaque nouveau jour
if NewDay then begin
    SearchHigh = 0;
    SearchLow = 999999;
    FoundHigh = false;
    FoundLow = false;
    LastTradingDate = 0;
    
    // Trouver dernier jour de trading
    LoopCounter = 1;
    while LoopCounter &lt;= 500 and LastTradingDate = 0 begin
        if LoopCounter &lt;= CurrentBar then begin
            if Date[LoopCounter] &lt;&gt; Date and 
               DayOfWeek(Date[LoopCounter]) &gt;= 2 and 
               DayOfWeek(Date[LoopCounter]) &lt;= 6 then begin
                LastTradingDate = Date[LoopCounter];
            end;
        end;
        LoopCounter = LoopCounter + 1;
    end;
    
    // Chercher PDH/PDL
    if LastTradingDate &gt; 0 then begin
        LoopCounter = 1;
        while LoopCounter &lt;= 500 begin
            if LoopCounter &lt;= CurrentBar then begin
                if Date[LoopCounter] = LastTradingDate and
                   Time[LoopCounter] &gt;= RegularSessionStart and 
                   Time[LoopCounter] &lt;= RegularSessionEnd then begin
                    
                    if High[LoopCounter] &gt; SearchHigh then begin
                        SearchHigh = High[LoopCounter];
                        FoundHigh = true;
                    end;
                    
                    if Low[LoopCounter] &lt; SearchLow then begin
                        SearchLow = Low[LoopCounter];
                        FoundLow = true;
                    end;
                end;
            end;
            LoopCounter = LoopCounter + 1;
        end;
    end;
    
    // Assigner PDH/PDL
    if FoundHigh then PDH = SearchHigh else PDH = 0;
    if FoundLow then PDL = SearchLow else PDL = 0;
    
    // CONSTRUIRE LES TABLEAUX DE NIVEAUX HISTORIQUES
    SupportCount = 0;
    ResistanceCount = 0;
    DaysScanned = 0;
    
    // Scanner les jours historiques pour construire les tableaux
    LoopCounter = 1;
    while LoopCounter &lt;= 1000 and DaysScanned &lt; MaxHistoricalDays begin
        if LoopCounter &lt;= CurrentBar then begin
            // Nouveau jour trouv?
            if Date[LoopCounter] &lt;&gt; Date and Date[LoopCounter] &lt;&gt; LastTradingDate and
               DayOfWeek(Date[LoopCounter]) &gt;= 2 and DayOfWeek(Date[LoopCounter]) &lt;= 6 then begin
                
                DaysScanned = DaysScanned + 1;
                SearchHigh = 0;
                SearchLow = 999999;
                
                // Trouver PDH/PDL de ce jour historique
                idx = LoopCounter;
                while idx &lt;= 1000 and idx &lt;= CurrentBar begin
                    if Date[idx] = Date[LoopCounter] and
                       Time[idx] &gt;= RegularSessionStart and Time[idx] &lt;= RegularSessionEnd then begin
                        if High[idx] &gt; SearchHigh then SearchHigh = High[idx];
                        if Low[idx] &lt; SearchLow then SearchLow = Low[idx];
                    end;
                    if Date[idx] &lt;&gt; Date[LoopCounter] then break;
                    idx = idx + 1;
                end;
                
                // Ajouter aux tableaux si valides
                if SearchLow &lt; 999999 and SupportCount &lt; 19 then begin
                    SupportLevels[SupportCount] = SearchLow;
                    SupportCount = SupportCount + 1;
                end;
                
                if SearchHigh &gt; 0 and ResistanceCount &lt; 19 then begin
                    ResistanceLevels[ResistanceCount] = SearchHigh;
                    ResistanceCount = ResistanceCount + 1;
                end;
            end;
        end;
        LoopCounter = LoopCounter + 1;
    end;
    
    // TRIER LES TABLEAUX (supports croissants, r?sistances croissantes)
    // Tri simple par bulles pour supports
    for idx = 0 to SupportCount - 2 begin
        for LoopCounter = 0 to SupportCount - 2 - idx begin
            if SupportLevels[LoopCounter] &gt; SupportLevels[LoopCounter + 1] then begin
                TempLevel = SupportLevels[LoopCounter];
                SupportLevels[LoopCounter] = SupportLevels[LoopCounter + 1];
                SupportLevels[LoopCounter + 1] = TempLevel;
            end;
        end;
    end;
    
    // Tri simple par bulles pour r?sistances  
    for idx = 0 to ResistanceCount - 2 begin
        for LoopCounter = 0 to ResistanceCount - 2 - idx begin
            if ResistanceLevels[LoopCounter] &gt; ResistanceLevels[LoopCounter + 1] then begin
                TempLevel = ResistanceLevels[LoopCounter];
                ResistanceLevels[LoopCounter] = ResistanceLevels[LoopCounter + 1];
                ResistanceLevels[LoopCounter + 1] = TempLevel;
            end;
        end;
    end;
    
    // Reset flags
    PDLBroken = false;
    PMLBroken = false;
    PDHBroken = false;
    PMHBroken = false;
    SequenceActive = false;
    RetestDone = false;
    TradesCountToday = 0;
    BrokenLevel = 0;
    EntryLevel = 0;
end;

// PMH/PML au debut de session
if SessionStart then begin
    PMHigh = 0;
    PMLow = 999999;
    HasPMData = false;
    
    LoopCounter = 1;
    while LoopCounter &lt;= 150 and LoopCounter &lt;= CurrentBar begin
        if Date[LoopCounter] = Date and
           Time[LoopCounter] &gt;= PreMarketStart and 
           Time[LoopCounter] &lt; RegularSessionStart then begin
            
            if High[LoopCounter] &gt; PMHigh then begin
                PMHigh = High[LoopCounter];
                HasPMData = true;
            end;
            
            if Low[LoopCounter] &lt; PMLow then begin
                PMLow = Low[LoopCounter];
                HasPMData = true;
            end;
        end;
        LoopCounter = LoopCounter + 1;
    end;
    
    if HasPMData then begin
        PMH = PMHigh;
        PML = PMLow;
    end else begin
        PMH = 0;
        PML = 0;
    end;
end;

// ==================== D?TECTION BREAKOUTS ====================

// Breakout SHORT (PDL ou PML)
if not SequenceActive and PDL &gt; 0 and PML &gt; 0 then begin
    // Break PDL
    if Close &lt; (PDL - BreakoutEpsilon) and Close[1] &gt;= (PDL - BreakoutEpsilon) then begin
        PDLBroken = true;
        SequenceActive = true;
        SequenceStartTime = Time;
        BreakoutBar = CurrentBar;
        BrokenLevel = PDL;
    end;
    
    // Break PML
    if Close &lt; (PML - BreakoutEpsilon) and Close[1] &gt;= (PML - BreakoutEpsilon) then begin
        PMLBroken = true;
        SequenceActive = true;
        SequenceStartTime = Time;
        BreakoutBar = CurrentBar;
        BrokenLevel = PML;
    end;
end;

// Breakout LONG (PDH ou PMH)
if not SequenceActive and PDH &gt; 0 and PMH &gt; 0 then begin
    // Break PDH
    if Close &gt; (PDH + BreakoutEpsilon) and Close[1] &lt;= (PDH + BreakoutEpsilon) then begin
        PDHBroken = true;
        SequenceActive = true;
        SequenceStartTime = Time;
        BreakoutBar = CurrentBar;
        BrokenLevel = PDH;
    end;
    
    // Break PMH
    if Close &gt; (PMH + BreakoutEpsilon) and Close[1] &lt;= (PMH + BreakoutEpsilon) then begin
        PMHBroken = true;
        SequenceActive = true;
        SequenceStartTime = Time;
        BreakoutBar = CurrentBar;
        BrokenLevel = PMH;
    end;
end;

// Timeout s?quence
if SequenceActive and Time &gt; (SequenceStartTime + SignalTimeWindow) then begin
    SequenceActive = false;
    RetestDone = false;
    PDLBroken = false;
    PMLBroken = false;
    PDHBroken = false;
    PMHBroken = false;
end;

// ==================== D?TECTION RETEST ====================

// Retest pour SHORT
if SequenceActive and (PDLBroken or PMLBroken) and not RetestDone and 
   CurrentBar &gt; BreakoutBar and BrokenLevel &gt; 0 then begin
    
    // Retest du niveau break? OU EMA13
    if (High &gt;= (BrokenLevel - BreakoutEpsilon) and Close &lt; (BrokenLevel - BreakoutEpsilon)) or
       (High &gt;= (EMA13 - BreakoutEpsilon) and Close &lt; (EMA13 - BreakoutEpsilon)) then begin
        RetestDone = true;
    end;
end;

// Retest pour LONG  
if SequenceActive and (PDHBroken or PMHBroken) and not RetestDone and 
   CurrentBar &gt; BreakoutBar and BrokenLevel &gt; 0 then begin
    
    // Retest du niveau break? OU EMA13
    if (Low &lt;= (BrokenLevel + BreakoutEpsilon) and Close &gt; (BrokenLevel + BreakoutEpsilon)) or
       (Low &lt;= (EMA13 + BreakoutEpsilon) and Close &gt; (EMA13 + BreakoutEpsilon)) then begin
        RetestDone = true;
    end;
end;

// ==================== CONDITIONS D&#39;ENTR?E ====================

// Conditions SHORT
CanEnterShort = (
    useShort = 1 and tw and
    SequenceActive and RetestDone and
    (PDLBroken or PMLBroken) and
    IsRegularSession and
    Close &lt; EMA13 and EMA13 &lt; EMA48 and EMA48 &lt; EMA200 and
    TradesCountToday &lt; MaxTradesPerDay and
    MarketPosition = 0 and
    PDL &gt; 0 and PDH &gt; 0 and
    Close &lt; PDH and
    PatternFast(PtnNeutSY , ohlcValues) and PatternFast(PtnNeutSN, ohlcValues)=false 
);

// Conditions LONG
CanEnterLong = (
    useLong = 1 and tw and
    SequenceActive and RetestDone and
    (PDHBroken or PMHBroken) and
    IsRegularSession and
    Close &gt; EMA13 and EMA13 &gt; EMA48 and EMA48 &gt; EMA200 and
    TradesCountToday &lt; MaxTradesPerDay and
    MarketPosition = 0 and
    PDL &gt; 0 and PDH &gt; 0 and
    Close &gt; PDL and
    PatternFast(PtnNeutLY , ohlcValues) and PatternFast(PtnNeutLN, ohlcValues)=false );
//    PtnNeutLY (152),     PtnNeutLN (153), PtnDirLY(152), PtnDirLN(153), 

// ==================== EX?CUTION DES ORDRES ====================

// ENTR?E SHORT
if CanEnterShort and authorizedTrading then begin
    SellShort mySize Contract next bar at market;
    EntryLevel = BrokenLevel;
    StopLevel = BrokenLevel + EpsilonSupport;
    
    // Trouver le prochain support pour TP
    TargetLevel = 0;
    for idx = SupportCount - 1 downto 0 begin
        if SupportLevels[idx] &lt; BrokenLevel then begin
            TargetLevel = SupportLevels[idx]  - EpsilonSupport;
            break;
        end;
    end;
    
    TradesCountToday = TradesCountToday + 1;
    
    // Reset s?quence
    SequenceActive = false;
    RetestDone = false;
end;

// ENTR?E LONG
if CanEnterLong and authorizedTrading then begin
    Buy mySize Contract next bar at market;
    EntryLevel = BrokenLevel;
    StopLevel = BrokenLevel - EpsilonSupport;
    
    // Trouver la prochaine r?sistance pour TP
    TargetLevel = 0;
    for idx = 0 to ResistanceCount - 1 begin
        if ResistanceLevels[idx] &gt; BrokenLevel then begin
            TargetLevel = ResistanceLevels[idx] + EpsilonSupport;
            break;
        end;
    end;
    
    TradesCountToday = TradesCountToday + 1;
    
    // Reset s?quence
    SequenceActive = false;
    RetestDone = false;
end;

// ==================== GESTION DES SORTIES ====================

// Take Profit
if MarketPosition = 1 and TargetLevel &gt; 0 and mySize&gt;1 then begin
    Sell (&quot;TPLong&quot;) floor(mySize/2) contract next bar at TargetLevel limit;
end;

if MarketPosition = -1 and TargetLevel &gt; 0 and mySize&gt;1 then begin
    BuyToCover (&quot;TP Short&quot;) floor(mySize/2) contract next bar at TargetLevel limit;
end;

// Stop Loss fixe
if MarketPosition = 1 and StopLevel &gt; 0 then begin
    Sell (&quot;LongSL&quot;) currentcontracts contracts next bar at StopLevel stop;
end;

if MarketPosition = -1 and StopLevel &gt; 0 then begin
    BuyToCover (&quot;ShortSL&quot;)  currentcontracts contracts next bar at StopLevel stop;
end;

// Trailing Stop EMA13
if MarketPosition = 1 and Close &lt; (EMA13 - EpsilonSupport) then begin
    Sell (&quot;LongEMA_SL&quot;)  currentcontracts contracts next bar at market;
end;

if MarketPosition = -1 and Close &gt; (EMA13 + EpsilonSupport) then begin
    BuyToCover(&quot;ShortEMA_SL&quot;)  currentcontracts contracts next bar at market;
end;

// Sortie fin de journ?e

if IsRegularSession and Time &gt;= (RegularSessionEnd - 10) then begin
    if MarketPosition = 1 then Sell (&quot;Long Exit EOS&quot;)  currentcontracts contracts next bar at market;
    if MarketPosition = -1 then BuyToCover (&quot;Short Exit EOS&quot;)  currentcontracts contracts next bar at market;
end;

// Stoploss global
setstoploss(maxSL);
// setexitonclose;

{
if Time &gt;= RegularSessionEnd then begin
   if MarketPosition = 1 then Sell (&quot;Long Exit EOS&quot;) currentcontracts contracts next bar at market;
   if MarketPosition = -1 then BuyToCover (&quot;Short Exit EOS&quot;) currentcontracts contracts next bar at market;
end;
}
// ==================== DEBUG ====================
// if NewDay then begin
//     Print(&quot;PDH: &quot;, PDH:4:2, &quot; PDL: &quot;, PDL:4:2, &quot; PMH: &quot;, PMH:4:2, &quot; PML: &quot;, PML:4:2);
//     Print(&quot;Supports: &quot;, SupportCount, &quot; R?sistances: &quot;, ResistanceCount);
//     for idx = 0 to SupportCount - 1 begin
//         Print(&quot;Support[&quot;, idx, &quot;]: &quot;, SupportLevels[idx]:4:2);
//     end;
//     for idx = 0 to ResistanceCount - 1 begin
//         Print(&quot;Resistance[&quot;, idx, &quot;]: &quot;, ResistanceLevels[idx]:4:2);
//     end;
// end;


//TITAN FAST EXPORT (mette il report direttamente in C:\Titan\Reports
input: TitanExportMode(0);
if TitanExportMode=1 then WriteDailiesCTitanReports(1100101, TitanExportMode);

</pre></div>
        
        <p style="margin-top: 20px; color: #7f8c8d; font-size: 0.9em;">
            G√©n√©r√© le 2025-11-28 18:02 | 
            Hash: 1d575b525644...
        </p>
    </div>
</body>
</html>